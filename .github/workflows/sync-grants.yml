name: Sync Grants Data (Daily)

on:
  # æ‰‹å‹•å®Ÿè¡Œã‚‚å¯èƒ½
  workflow_dispatch:
  # æ¯æ—¥ åˆå‰5æ™‚ï¼ˆæ—¥æœ¬æ™‚é–“ï¼‰ã«è‡ªå‹•å®Ÿè¡Œï¼ˆUTCã§20æ™‚ï¼‰
  schedule:
    - cron: '0 20 * * *'

jobs:
  sync-grants:
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ§­ ãƒªãƒã‚¸ãƒˆãƒªã‚’ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆ
        uses: actions/checkout@v4

      - name: ğŸŸ¢ Node.js ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
        uses: actions/setup-node@v4
        with:
          node-version: 20

      - name: ğŸ“¦ pnpm ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
        uses: pnpm/action-setup@v4
        with:
          version: 9
          run_install: true

      - name: âš™ï¸ ç’°å¢ƒå¤‰æ•°ã‚’ã‚»ãƒƒãƒˆ
        env:
          SUPABASE_URL: ${{ secrets.SUPABASE_URL }}
          SUPABASE_SERVICE_ROLE_KEY: ${{ secrets.SUPABASE_SERVICE_ROLE_KEY }}
        run: |
          echo "ç’°å¢ƒå¤‰æ•°ã‚’ã‚»ãƒƒãƒˆã—ã¾ã—ãŸã€‚"
          echo "Supabase URL: âœ… è¨­å®šæ¸ˆã¿"
          echo "Service Role Key: âœ… è¨­å®šæ¸ˆã¿"

      - name: ğŸš€ è£œåŠ©é‡‘ãƒ‡ãƒ¼ã‚¿åŒæœŸã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å®Ÿè¡Œ
        env:
          SUPABASE_URL: ${{ secrets.SUPABASE_URL }}
          SUPABASE_SERVICE_ROLE_KEY: ${{ secrets.SUPABASE_SERVICE_ROLE_KEY }}
        run: |
          echo "ğŸ§  è£œåŠ©é‡‘ãƒ‡ãƒ¼ã‚¿ã®åŒæœŸã‚’é–‹å§‹ã—ã¾ã™..."
          pnpm tsx apps/web/scripts/sync_grants.ts
          echo "âœ… åŒæœŸå®Œäº†"

      - name: ğŸªµ çµæœãƒ­ã‚°ã‚’ç¢ºèª
        run: echo "âœ… è£œåŠ©é‡‘ãƒ»åŠ©æˆé‡‘ãƒ‡ãƒ¼ã‚¿ã®è‡ªå‹•åŒæœŸãŒå®Œäº†ã—ã¾ã—ãŸã€‚"


